<!DOCTYPE html>
<html lang="en">
<head>
    <!-- add mocha css, to show results -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.css">
    <!-- add mocha framework code -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mocha/3.2.0/mocha.js"></script>
    <script>
        mocha.setup('bdd'); // minimal setup
    </script>
    <!-- add chai -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/3.5.0/chai.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sinon.js/15.2.0/sinon.min.js"></script>

    <script>
        // chai has a lot of stuff, let's make assert global
        let assert = chai.assert;

    </script>
    <title>Data types tests</title>
</head>
<body>

<script>
    function recursivePow(a, n) {
        if (n < 0) return recursivePow(1 / a, -n);
        if (n === 0) return 1;
        return (n === 1) ? a : a * recursivePow(a, n - 1);
    }

    function recursiveSumSalaries(obj) {
        if (Array.isArray(obj)) {
            return obj.reduce((prev, current) => prev + current.salary, 0);
        } else {
            let sum = 0;
            for (let subDepartment of Object.values(obj)) {
                sum += recursiveSumSalaries(subDepartment);
            }
            return sum;
        }
    }

    let sumTo = a => (a === 0) ? 0 : a + sumTo(a - 1);
    let mathSumTo = a => (a + 1) * a / 2;

    let factorial = n => (n <= 1) ? 1 : n * factorial(n - 1);
    let fibonacci = n => n <= 1 ? n : fibonacci(n - 2) + fibonacci(n - 1)

    let listToArray = list => (!list.next) ? [list.value] : [list.value].concat(listToArray(list.next));
    let reverseListToArray = list => (!list.next) ? [list.value] : reverseListToArray(list.next).concat([list.value]);


    let listToArrayLoop = list => {
        let reference = list;
        let result = [];
        while (reference) {
            result.push(reference.value);
            reference = reference.next;
        }
        return result;
    };

    let reversedListToArrayLoop = list => {
        let reference = list;
        let result = [];
        while (reference) {
            result.push(reference.value);
            reference = reference.next;
        }
        return result.reverse();
    };

    // closures with arrow functions are pretty
    let sum = (a) => b => a + b;

    function sumV2(a) {
        return function (b) {
            return a + b;
        }
    }

    let inBetween = (a, b) => x => (x >= a && x <= b);

    function inBetweenV2(a, b) {
        return function (x) {
            return (x >= a && x <= b);
        }
    }

    let inArray = args => x => args.includes(x);

    function inArrayV2(args) {
        return function (x) {
            return args.includes(x);
        }
    }

    // not necessarily nice solution, but wanted to have some fun
    function fibonacciV2(n) {

        if (n <= 1) return n;

        let first = fibonacciV2.map.get(Math.max(0, n - 2)) || fibonacciV2(n - 3) + fibonacciV2(n - 4)
        let second = fibonacciV2.map.get(Math.max(0, n - 1)) || fibonacciV2(n - 2) + fibonacciV2(n - 3)
        let result = first + second;
        fibonacciV2.map.set(n, result)

        return result;
    }

    fibonacciV2.map = new Map();
    fibonacciV2.map.set(0, 0)
    fibonacciV2.map.set(1, 1)


    function makeCounter() {
        let count = 0;

        function counter() {
            return ++count;
        }

        counter.set = value => count = value;
        counter.decrease = () => --count;

        return counter;
    }

    function funnySum(a) {
        let sum = a;

        function add(value) {
            sum += value;
            return add;
        }

        add.valueOf = () => `${sum}`;
        return add;
    }

    // does not see variables in current scope, only the globals
    let notSafeSum = new Function('a', 'b', 'return a + b');
    new Function('a', 'b', 'return a + b'); // basic syntax
    new Function('a,b', 'return a + b'); // comma-separated
    new Function('a , b', 'return a + b'); // comma-separated with spaces

    async function sayHi(phrase, who) {
        if (who === 'lol') {
            console.log('waiting for 1 sec')
            await new Promise(r => setTimeout(r, 10000));
        }
        alert(phrase + ', ' + who);
    }

    function printNumbersTimeout(from, to) {
        let current = from;
        setTimeout(function go() {
            console.log(`${current} at ${Date.now()}`)
            if (current < to) {
                setTimeout(go, 100)
            }
            current++;
        }, 100);
    }

    function printNumbersInterval(from, to) {
        let current = from;
        let intervalId = setInterval(function go() {
            console.log(`${current} at ${Date.now()}`)
            if (current === to) {
                clearInterval(intervalId);
            }
            current++;
        }, 100);
    }

    printNumbersTimeout(5, 10);
    printNumbersInterval(5, 10);

    // setInterval(printNumbers, 100, 5, 10);


</script>

<script src="advanced-functions/testAdvancedFunctions.js"></script>
<div id="mocha"></div>
<!-- run tests! -->
<script> mocha.run(); </script>
</body>
</html>